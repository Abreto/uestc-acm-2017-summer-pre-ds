\documentclass{ctexart}
\pagestyle{plain}
\begin{document}
\section*{L - 老司机的奇幻漂流}

并查集.

记题中提到的三种动物（组成的集合）为 $A$、$B$ 和 $C$，且它们形成如下的食物链（箭头指向食物）.
\[
\begin{array}{ccccc}
&&A&&\\
&\nearrow&&\searrow&\\
C&&\gets&&B
\end{array}
\]

用 $T(x)$ 表示断言 $x \in T$，其中 $T \in \{A, B, C\}$.
处于同一个集合中的断言要么同时为真，要么同时为假，即都具有相同的真假判断.
显然同一个集合中不可能同时出现 $T_1(x)$ 和 $T_2(x)$ 且 $T_1 \ne T_2$.

初始时对每一个动物 $x$，都创建三个断言 $A(x), B(x), C(x)$ 属于各自的集合.
然后依次读入每条记录.

若 $x$ 与 $y$ 是同类，则 $A(x)\sim{}A(y)$、$B(x)\sim{}B(y)$、$C(x)\sim{}C(y)$ 中每组断言具有相同的真假性，
于是分别把它们并起来.

若 $x$ 吃 $y$，在 $x \ne y$ 的情况下，$A(x)\sim{}B(y)$、$B(x)\sim{}C(y)$、$C(x)\sim{}A(y)$ 中每组断言具有相同的真假性，
分别把它们并起来.

现在考虑什么情况下对于 $T_1 \ne T_2$，一个集合中会同时出现 $T_1(x)$ 和 $T_2(x)$.

当 $x$ 与 $y$ 是同类时，在这之前，$A(x)$、$B(x)$、$C(x)$ 以及 $A(y)$、$B(y)$、$C(y)$ 都不在同一集合.
若合并之后 $A(x)\sim{}B(x)$，则一定有 $A(x)\sim{}B(y)$ 或 $A(y)\sim{}B(x)$.
同理有 $A(x)\sim{}C(y)$ 或 $A(y)\sim{}C(x)$、$B(x)\sim{}C(y)$ 或 $B(y)\sim{}C(x)$.
这些情况综合下来，也就是之前出现了 $x$ 吃 $y$ 或者 $y$ 吃 $x$.
于是只需要判断在合并之前是否有 $A(x)\sim{}B(y)$ 或 $A(x)\sim{}C(y)$ 即可.
如果有，那么这是一条错误记录；否则就执行合并操作.

同理，在 $x$ 吃 $y$ 时，要检查是否有 $A(x)\sim{}A(y)$ 或 $A(x)\sim{}C(y)$.

时间复杂度 $O(M\alpha(M,N))$.

\end{document}
